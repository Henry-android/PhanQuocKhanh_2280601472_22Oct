<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Upload ·∫¢nh - User Avatar & Multiple Images</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        color: white;
        margin-bottom: 30px;
        font-size: 2.5em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .cards-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
        gap: 30px;
        margin-bottom: 30px;
      }

      .card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        transition: transform 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
      }

      .card h2 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.8em;
        border-bottom: 3px solid #667eea;
        padding-bottom: 10px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 10px;
        color: #333;
        font-weight: 600;
        font-size: 1.1em;
      }

      input[type="text"],
      input[type="password"] {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1em;
        transition: border-color 0.3s ease;
      }

      input[type="text"]:focus,
      input[type="password"]:focus {
        outline: none;
        border-color: #667eea;
      }

      .file-input-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
        width: 100%;
      }

      .file-input-wrapper input[type="file"] {
        position: absolute;
        left: -9999px;
      }

      .file-input-label {
        display: block;
        padding: 15px 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        text-align: center;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 1.1em;
        transition: all 0.3s ease;
      }

      .file-input-label:hover {
        transform: scale(1.02);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .file-name {
        margin-top: 10px;
        color: #666;
        font-size: 0.9em;
        font-style: italic;
      }

      .btn {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.2em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 20px;
      }

      .btn:hover {
        transform: scale(1.02);
        box-shadow: 0 5px 15px rgba(17, 153, 142, 0.4);
      }

      .btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }

      .preview-container {
        margin-top: 20px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
      }

      .preview-item {
        position: relative;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
      }

      .preview-item img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        display: block;
      }

      .preview-item .remove-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(255, 0, 0, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        cursor: pointer;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .message {
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        font-weight: 500;
        display: none;
      }

      .message.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        display: block;
      }

      .message.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
        display: block;
      }

      .avatar-preview {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        margin: 20px auto;
        overflow: hidden;
        border: 4px solid #667eea;
        display: none;
      }

      .avatar-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .loading {
        display: none;
        text-align: center;
        margin-top: 20px;
      }

      .loading.active {
        display: block;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 768px) {
        .cards-container {
          grid-template-columns: 1fr;
        }

        h1 {
          font-size: 1.8em;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üé® Upload ·∫¢nh Avatar & Multiple Images</h1>

      <div class="cards-container">
        <!-- Card 1: Upload Avatar -->
        <div class="card">
          <h2>üì∏ Upload Avatar (ƒêƒÉng nh·∫≠p required)</h2>

          <form id="avatarForm">
            <div class="form-group">
              <label for="token">JWT Token:</label>
              <input
                type="text"
                id="token"
                name="token"
                placeholder="Nh·∫≠p Bearer token..."
                required
              />
            </div>

            <div class="form-group">
              <label>Ch·ªçn ·∫£nh avatar:</label>
              <div class="file-input-wrapper">
                <input type="file" id="avatarFile" accept="image/*" required />
                <label for="avatarFile" class="file-input-label">
                  üìÇ Ch·ªçn ·∫£nh avatar
                </label>
              </div>
              <div id="avatarFileName" class="file-name"></div>
            </div>

            <div class="avatar-preview" id="avatarPreview">
              <img id="avatarPreviewImg" src="" alt="Avatar preview" />
            </div>

            <button type="submit" class="btn">‚¨ÜÔ∏è Upload Avatar</button>
          </form>

          <div class="loading" id="avatarLoading">
            <div class="spinner"></div>
            <p>ƒêang upload...</p>
          </div>

          <div id="avatarMessage" class="message"></div>
        </div>

        <!-- Card 2: Upload Multiple Images -->
        <div class="card">
          <h2>üñºÔ∏è Upload Nhi·ªÅu ·∫¢nh (ƒêƒÉng nh·∫≠p required)</h2>

          <form id="multipleForm">
            <div class="form-group">
              <label for="tokenMultiple">JWT Token:</label>
              <input
                type="text"
                id="tokenMultiple"
                name="token"
                placeholder="Nh·∫≠p Bearer token..."
                required
              />
            </div>

            <div class="form-group">
              <label>Ch·ªçn nhi·ªÅu ·∫£nh:</label>
              <div class="file-input-wrapper">
                <input
                  type="file"
                  id="multipleFiles"
                  accept="image/*"
                  multiple
                  required
                />
                <label for="multipleFiles" class="file-input-label">
                  üìÇ Ch·ªçn nhi·ªÅu ·∫£nh
                </label>
              </div>
              <div id="multipleFileNames" class="file-name"></div>
            </div>

            <div class="preview-container" id="multiplePreview"></div>

            <button type="submit" class="btn">‚¨ÜÔ∏è Upload T·∫•t C·∫£</button>
          </form>

          <div class="loading" id="multipleLoading">
            <div class="spinner"></div>
            <p>ƒêang upload...</p>
          </div>

          <div id="multipleMessage" class="message"></div>
        </div>
      </div>
    </div>

    <script>
      // Avatar Upload
      const avatarForm = document.getElementById("avatarForm");
      const avatarFile = document.getElementById("avatarFile");
      const avatarFileName = document.getElementById("avatarFileName");
      const avatarPreview = document.getElementById("avatarPreview");
      const avatarPreviewImg = document.getElementById("avatarPreviewImg");
      const avatarMessage = document.getElementById("avatarMessage");
      const avatarLoading = document.getElementById("avatarLoading");

      // Preview avatar when selected
      avatarFile.addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (file) {
          avatarFileName.textContent = `ƒê√£ ch·ªçn: ${file.name}`;

          const reader = new FileReader();
          reader.onload = function (e) {
            avatarPreviewImg.src = e.target.result;
            avatarPreview.style.display = "block";
          };
          reader.readAsDataURL(file);
        }
      });

      // Submit avatar
      avatarForm.addEventListener("submit", async function (e) {
        e.preventDefault();

        const token = document.getElementById("token").value;
        const file = avatarFile.files[0];

        if (!file) {
          showMessage(avatarMessage, "Vui l√≤ng ch·ªçn file!", "error");
          return;
        }

        const formData = new FormData();
        formData.append("avatar", file);

        try {
          avatarLoading.classList.add("active");
          avatarMessage.style.display = "none";

          const response = await fetch("/users/upload-avatar", {
            method: "POST",
            headers: {
              Authorization: `Bearer ${token}`,
            },
            body: formData,
          });

          const data = await response.json();

          avatarLoading.classList.remove("active");

          if (data.success) {
            showMessage(
              avatarMessage,
              `‚úÖ Upload th√†nh c√¥ng! Avatar URL: ${data.data.avatarURL}`,
              "success"
            );
          } else {
            showMessage(
              avatarMessage,
              `‚ùå L·ªói: ${data.message || "Upload th·∫•t b·∫°i"}`,
              "error"
            );
          }
        } catch (error) {
          avatarLoading.classList.remove("active");
          showMessage(avatarMessage, `‚ùå L·ªói: ${error.message}`, "error");
        }
      });

      // Multiple Files Upload
      const multipleForm = document.getElementById("multipleForm");
      const multipleFiles = document.getElementById("multipleFiles");
      const multipleFileNames = document.getElementById("multipleFileNames");
      const multiplePreview = document.getElementById("multiplePreview");
      const multipleMessage = document.getElementById("multipleMessage");
      const multipleLoading = document.getElementById("multipleLoading");

      let selectedFiles = [];

      // Preview multiple files when selected
      multipleFiles.addEventListener("change", function (e) {
        selectedFiles = Array.from(e.target.files);
        displayMultiplePreview();
      });

      function displayMultiplePreview() {
        multipleFileNames.textContent = `ƒê√£ ch·ªçn: ${selectedFiles.length} file(s)`;
        multiplePreview.innerHTML = "";

        selectedFiles.forEach((file, index) => {
          const reader = new FileReader();
          reader.onload = function (e) {
            const previewItem = document.createElement("div");
            previewItem.className = "preview-item";
            previewItem.innerHTML = `
                        <img src="${e.target.result}" alt="Preview ${
              index + 1
            }">
                        <button type="button" class="remove-btn" onclick="removeFile(${index})">√ó</button>
                    `;
            multiplePreview.appendChild(previewItem);
          };
          reader.readAsDataURL(file);
        });
      }

      function removeFile(index) {
        selectedFiles.splice(index, 1);
        displayMultiplePreview();

        // Update file input
        const dt = new DataTransfer();
        selectedFiles.forEach((file) => dt.items.add(file));
        multipleFiles.files = dt.files;
      }

      // Submit multiple files
      multipleForm.addEventListener("submit", async function (e) {
        e.preventDefault();

        const token = document.getElementById("tokenMultiple").value;

        if (selectedFiles.length === 0) {
          showMessage(
            multipleMessage,
            "Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 file!",
            "error"
          );
          return;
        }

        const formData = new FormData();
        selectedFiles.forEach((file) => {
          formData.append("files", file);
        });

        try {
          multipleLoading.classList.add("active");
          multipleMessage.style.display = "none";

          const response = await fetch("/files/upload-multiple", {
            method: "POST",
            headers: {
              Authorization: `Bearer ${token}`,
            },
            body: formData,
          });

          const data = await response.json();

          multipleLoading.classList.remove("active");

          if (data.success) {
            showMessage(
              multipleMessage,
              `‚úÖ Upload th√†nh c√¥ng ${data.data.length} file(s)!`,
              "success"
            );

            // Clear preview
            selectedFiles = [];
            multiplePreview.innerHTML = "";
            multipleFileNames.textContent = "";
            multipleForm.reset();
          } else {
            showMessage(
              multipleMessage,
              `‚ùå L·ªói: ${data.message || "Upload th·∫•t b·∫°i"}`,
              "error"
            );
          }
        } catch (error) {
          multipleLoading.classList.remove("active");
          showMessage(multipleMessage, `‚ùå L·ªói: ${error.message}`, "error");
        }
      });

      // Helper function
      function showMessage(element, text, type) {
        element.textContent = text;
        element.className = `message ${type}`;
        element.style.display = "block";
      }
    </script>
  </body>
</html>
